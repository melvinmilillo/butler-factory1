name: üöÄ Content Factory (Conveyor Mode)

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      # 1. –ü–æ–ª—É—á–∞–µ–º –∫–æ–¥ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
      - name: ‚¨áÔ∏è Checkout repo
        uses: actions/checkout@v4
        # –í–ê–ñ–ù–û: –î–∞–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ push –æ–±—Ä–∞—Ç–Ω–æ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
        
      # 2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Node.js
      - name: ‚öôÔ∏è Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      # 3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (—ç—Ç–æ—Ç —à–∞–≥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑)
      - name: üì¶ Install dependencies
        run: npm install

      # 4. –ù–ê–ß–ê–õ–û –ö–û–ù–í–ï–ô–ï–†–ê
      - name: üè≠ Run Content Factory Conveyor
        run: |
          # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º Git –û–î–ò–ù –†–ê–ó –ø–µ—Ä–µ–¥ —Ü–∏–∫–ª–æ–º
          git config --global user.name 'GitHub Actions Bot'
          git config --global user.email 'actions-bot@github.com'
          
          # –ó–∞–ø—É—Å–∫–∞–µ–º –∫–æ–Ω–≤–µ–π–µ—Ä –≤ —Ü–∏–∫–ª–µ. 5 —Ä–∞–∑ –ø–æ 50 —Å—Ç–∞—Ç–µ–π = –¥–æ 250 —Å—Ç–∞—Ç–µ–π.
          # –í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å {1..5} –Ω–∞ {1..10}, –µ—Å–ª–∏ —Ç–µ–º –±—É–¥–µ—Ç –±–æ–ª—å—à–µ.
          for i in {1..5}
          do
            echo "--- –ö–û–ù–í–ï–ô–ï–†: –ó–∞–ø—É—Å–∫ –∏—Ç–µ—Ä–∞—Ü–∏–∏ $i ---"
            
            # –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞–≤–æ–¥, –∫–æ—Ç–æ—Ä—ã–π —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –°–õ–ï–î–£–Æ–©–ò–ï 50 —Å—Ç–∞—Ç–µ–π
            npm run factory
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª–∏ –ª–∏ —Å–æ–∑–¥–∞–Ω—ã –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã –≤ —ç—Ç–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏
            if [[ -z $(git status --porcelain) ]]; then
              echo "‚úÖ –ù–æ–≤—ã—Ö —Å—Ç–∞—Ç–µ–π –≤ —ç—Ç–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ –Ω–µ—Ç. –†–∞–±–æ—Ç–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–µ—Ä—à–µ–Ω–∞."
              break # –í—ã—Ö–æ–¥–∏–º –∏–∑ —Ü–∏–∫–ª–∞, –µ—Å–ª–∏ –≤—Å–µ —Ç–µ–º—ã –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
            fi

            # –ï—Å–ª–∏ —Ñ–∞–π–ª—ã –µ—Å—Ç—å, –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∏—Ö –ø—É–±–ª–∏–∫—É–µ–º
            echo "üî• –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –Ω–æ–≤—ã–µ —Å—Ç–∞—Ç—å–∏. –û—Ç–ø—Ä–∞–≤–ª—è—é –ø–∞—á–∫—É $i..."
            git add .
            git commit -m "üöÄ –ê–≤—Ç–æ-–ø—É–±–ª–∏–∫–∞—Ü–∏—è: –ø–∞—á–∫–∞ —Å—Ç–∞—Ç–µ–π ‚Ññ$i"
            git push
            echo "‚úÖ –ü–∞—á–∫–∞ $i —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏—é."
          done
