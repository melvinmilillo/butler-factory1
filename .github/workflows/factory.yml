name: üöÄ Content Factory

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: ‚¨áÔ∏è Checkout repo
        uses: actions/checkout@v4
        
      # –≠–¢–û–¢ –ë–õ–û–ö –¢–ï–ü–ï–†–¨ –°–û–î–ï–†–ñ–ò–¢ "–û–ß–ò–°–¢–ö–£ –ö–≠–®–ê"
      - name: ‚öôÔ∏è Setup Node.js with Cache
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          # –î–æ–±–∞–≤–ª—è–µ–º –∫–ª—é—á –∫–µ—à–∞, —á—Ç–æ–±—ã —Å–±—Ä–æ—Å–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
          cache: 'npm'
          cache-dependency-path: package-lock.json

      # –≠–¢–û –ì–õ–ê–í–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –ö–û–ú–ê–ù–î–ê –£–°–¢–ê–ù–û–í–ö–ò
      - name: üì¶ Install dependencies
        run: npm install

      - name: üè≠ Run Content Factory
        run: npm run factory
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}

      - name: üöÄ Commit and Push new posts
        run: |
          git config --global user.name 'GitHub Actions Bot'
          git config --global user.email 'actions-bot@github.com'
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
          if [[ -z $(git status --porcelain) ]]; then
            echo "‚úÖ –ù–µ—Ç –Ω–æ–≤—ã—Ö —Å—Ç–∞—Ç–µ–π –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π. –†–∞–±–æ—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞."
            exit 0
          fi
          
          echo "üî• –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã. –ù–∞—á–∏–Ω–∞—é –æ—Ç–ø—Ä–∞–≤–∫—É..."
          git add .
          git commit -m "üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Å—Ç–∞—Ç—å–∏ –∏ —Ñ–∞–π–ª—ã"
          git push
