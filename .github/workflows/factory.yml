name: üöÄ Content Factory (Conveyor Mode)

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: ‚¨áÔ∏è Checkout repo
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
        
      - name: ‚öôÔ∏è Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: üì¶ Install dependencies
        run: npm install

      # –ù–ê–ß–ê–õ–û –ö–û–ù–í–ï–ô–ï–†–ê (–° –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ù–´–ú "–¢–û–ü–õ–ò–í–û–ü–†–û–í–û–î–û–ú")
      - name: üè≠ Run Content Factory Conveyor
        # –í–û–¢ –ö–õ–Æ–ß–ï–í–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–û–ë–ê–í–õ–Ø–ï–ú –ë–õ–û–ö `env`
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º Git –û–î–ò–ù –†–ê–ó –ø–µ—Ä–µ–¥ —Ü–∏–∫–ª–æ–º
          git config --global user.name 'GitHub Actions Bot'
          git config --global user.email 'actions-bot@github.com'
          
          # –ó–∞–ø—É—Å–∫–∞–µ–º –∫–æ–Ω–≤–µ–π–µ—Ä –≤ —Ü–∏–∫–ª–µ. 5 —Ä–∞–∑ –ø–æ 50 —Å—Ç–∞—Ç–µ–π = –¥–æ 250 —Å—Ç–∞—Ç–µ–π.
          for i in {1..5}
          do
            echo "--- –ö–û–ù–í–ï–ô–ï–†: –ó–∞–ø—É—Å–∫ –∏—Ç–µ—Ä–∞—Ü–∏–∏ $i ---"
            
            # –¢–µ–ø–µ—Ä—å —ç—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –±—É–¥–µ—Ç –∑–∞–ø—É—â–µ–Ω–∞ –≤ —Å—Ä–µ–¥–µ, –≥–¥–µ –µ—Å—Ç—å API-–∫–ª—é—á
            npm run factory
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª–∏ –ª–∏ —Å–æ–∑–¥–∞–Ω—ã –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã
            if [[ -z $(git status --porcelain) ]]; then
              echo "‚úÖ –ù–æ–≤—ã—Ö —Å—Ç–∞—Ç–µ–π –≤ —ç—Ç–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ –Ω–µ—Ç. –†–∞–±–æ—Ç–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–µ—Ä—à–µ–Ω–∞."
              break
            fi

            # –ï—Å–ª–∏ —Ñ–∞–π–ª—ã –µ—Å—Ç—å, –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∏—Ö –ø—É–±–ª–∏–∫—É–µ–º
            echo "üî• –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –Ω–æ–≤—ã–µ —Å—Ç–∞—Ç—å–∏. –û—Ç–ø—Ä–∞–≤–ª—è—é –ø–∞—á–∫—É $i..."
            git add .
            git commit -m "üöÄ –ê–≤—Ç–æ-–ø—É–±–ª–∏–∫–∞—Ü–∏—è: –ø–∞—á–∫–∞ —Å—Ç–∞—Ç–µ–π ‚Ññ$i"
            git push
            echo "‚úÖ –ü–∞—á–∫–∞ $i —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏—é."
          done
