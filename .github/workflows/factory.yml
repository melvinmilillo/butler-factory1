name: üöÄ Content Factory (Configurable Conveyor)

on:
  workflow_dispatch:
    inputs:
      batch_size:
        description: '–°–∫–æ–ª—å–∫–æ —Å—Ç–∞—Ç–µ–π –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞ 1 –∏—Ç–µ—Ä–∞—Ü–∏—é?'
        required: true
        default: '10'
      iterations:
        description: '–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω–≤–µ–π–µ—Ä?'
        required: true
        default: '5'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: ‚¨áÔ∏è Checkout repo
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
        
      - name: ‚öôÔ∏è Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: üì¶ Install dependencies
        run: npm install

      - name: üè≠ Run Content Factory Conveyor
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          # –ü–µ—Ä–µ–¥–∞–µ–º —Ä–∞–∑–º–µ—Ä –ø–∞—á–∫–∏ –≤ —Å–∫—Ä–∏–ø—Ç
          BATCH_SIZE: ${{ github.event.inputs.batch_size }}
        run: |
          git config --global user.name 'GitHub Actions Bot'
          git config --global user.email 'actions-bot@github.com'
          
          # –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Ç–µ—Ä–∞—Ü–∏–π –∏–∑ –∏–Ω–ø—É—Ç–æ–≤
          for i in $(seq 1 ${{ github.event.inputs.iterations }})
          do
            echo "--- –ö–û–ù–í–ï–ô–ï–†: –ó–∞–ø—É—Å–∫ –∏—Ç–µ—Ä–∞—Ü–∏–∏ $i ---"
            npm run factory
            
            if [[ -z $(git status --porcelain) ]]; then
              echo "‚úÖ –ù–æ–≤—ã—Ö —Å—Ç–∞—Ç–µ–π –≤ —ç—Ç–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ –Ω–µ—Ç. –†–∞–±–æ—Ç–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–µ—Ä—à–µ–Ω–∞."
              break
            fi

            echo "üî• –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –Ω–æ–≤—ã–µ —Å—Ç–∞—Ç—å–∏. –û—Ç–ø—Ä–∞–≤–ª—è—é –ø–∞—á–∫—É $i..."
            git add .
            git commit -m "üöÄ –ê–≤—Ç–æ-–ø—É–±–ª–∏–∫–∞—Ü–∏—è: –ø–∞—á–∫–∞ —Å—Ç–∞—Ç–µ–π ‚Ññ$i"
            git push
            echo "‚úÖ –ü–∞—á–∫–∞ $i —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏—é."
          done
